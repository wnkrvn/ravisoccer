<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fazenda Feliz ‚Äî Prot√≥tipo</title>
  <style>
    :root {
      --bg:#0b1e14;/* verde-escuro */
      --panel:#10271a;
      --panel-2:#143221;
      --accent:#7ce38b;
      --accent-2:#3bd06e;
      --text:#e9ffe9;
      --muted:#bde8c6;
      --danger:#ffb4b4;
      --warning:#ffd27a;
      --shadow:0 10px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial;
      background:linear-gradient(180deg,#082012, var(--bg));
      color:var(--text);
    }
    .app{
      display:grid; gap:14px; padding:14px; 
      grid-template-columns: 320px 1fr; 
      grid-template-rows: auto 1fr auto;
      max-width:1200px; margin:0 auto;
    }
    header, aside, main, footer{ border-radius:18px; box-shadow:var(--shadow); }
    header{ grid-column:1/-1; background:linear-gradient(90deg,var(--panel),var(--panel-2)); padding:14px 16px; display:flex; align-items:center; gap:12px; justify-content:space-between;}
    header .title{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.4px;}
    header .title .logo{ font-size:28px; filter:drop-shadow(0 6px 8px rgba(0,0,0,.25));}
    header .title h1{ font-size:20px; margin:0; }
    .stats{ display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .chip{ background:rgba(255,255,255,.06); padding:8px 12px; border-radius:999px; display:flex; align-items:center; gap:8px; font-weight:700;}
    .bar{ width:160px; height:10px; background:#1a3b29; border-radius:999px; overflow:hidden;}
    .bar > span{ display:block; height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2));}aside{ background:var(--panel); padding:14px; display:flex; flex-direction:column; gap:14px;}
.card{ background:var(--panel-2); border-radius:14px; padding:12px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.04)}
.card h3{ margin:0 0 8px 0; font-size:14px; color:var(--muted); font-weight:700; text-transform:uppercase; letter-spacing:.8px}
.shop-item{ display:flex; align-items:center; justify-content:space-between; padding:8px; border-radius:12px; background:rgba(255,255,255,.04); margin-bottom:8px }
.shop-item .meta{ display:flex; align-items:center; gap:10px; font-weight:700 }
.shop-item .meta .emoji{ font-size:22px }
.shop-item button{ border:0; padding:8px 10px; border-radius:10px; background:var(--accent-2); color:#002a0f; font-weight:900; cursor:pointer }
.shop-item button:disabled{ filter:grayscale(1); opacity:.6; cursor:not-allowed }

.inventory{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px }
.inv{ background:rgba(255,255,255,.05); border-radius:12px; padding:10px; text-align:center; font-weight:700 }
.inv .emoji{ font-size:22px; display:block }

main{ background:linear-gradient(180deg,#0e281a, #0f2419); padding:14px;}
.toolbar{ display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap }
.btn{ border:0; background:rgba(255,255,255,.06); color:var(--text); padding:10px 12px; border-radius:12px; font-weight:800; cursor:pointer }
.btn.primary{ background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#03270f }
.btn.warn{ background:linear-gradient(90deg,#ffd27a,#ffb46a); color:#3a1f00 }
.btn.danger{ background:linear-gradient(90deg,#ff8a8a,#ffb4b4); color:#3a0000 }

.field{ display:grid; grid-template-columns: repeat(6, 1fr); grid-auto-rows: 96px; gap:10px }
.plot{ position:relative; border-radius:18px; padding:8px; background:linear-gradient(180deg,#452f1a,#2d1e10); box-shadow: inset 0 -8px 0 rgba(0,0,0,.25), inset 0 0 0 2px rgba(255,255,255,.04)}
.plot.empty{ background:linear-gradient(180deg,#5a3b1f,#3a2816)}
.plot .cell{ position:absolute; inset:10px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:34px; filter: drop-shadow(0 6px 10px rgba(0,0,0,.4)); }
.plot .timer{ position:absolute; left:10px; top:10px; background:rgba(0,0,0,.35); padding:3px 6px; border-radius:8px; font-size:12px }
.plot .stage{ position:absolute; right:10px; bottom:10px; background:rgba(0,0,0,.35); padding:3px 6px; border-radius:8px; font-size:12px }
.plot.locked{ filter:grayscale(1); opacity:.6 }

footer{ grid-column:1/-1; background:var(--panel); display:flex; align-items:center; justify-content:space-between; padding:10px 12px }
.link{ opacity:.8 }

/* Mobile */
@media (max-width: 980px) {
  .app{ grid-template-columns:1fr; }
  aside{ order:2 }
  main{ order:1 }
}

  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="title">
        <div class="logo">üåæ</div>
        <h1>Fazenda Feliz ‚Äî Prot√≥tipo</h1>
      </div>
      <div class="stats">
        <div class="chip" title="Moedas"><span>ü™ô</span><span id="coins">0</span></div>
        <div class="chip" title="Energia"><span>‚ö°</span><span id="energy">100</span></div>
        <div class="chip" title="N√≠vel & XP">
          <span>üéñÔ∏è</span>
          <span id="level">1</span>
          <div class="bar" aria-label="Barra de XP"><span id="xpbar" style="width:0%"></span></div>
          <span id="xptext">0/50</span>
        </div>
        <button class="btn" id="muteBtn">üîä Som</button>
      </div>
    </header><aside>
  <section class="card">
    <h3>Loja de Sementes</h3>
    <div id="shop"></div>
  </section>
  <section class="card">
    <h3>Invent√°rio</h3>
    <div class="inventory" id="inventory"></div>
  </section>
  <section class="card">
    <h3>Gerenciar</h3>
    <div class="toolbar">
      <button class="btn warn" id="sellAll">Vender Tudo (üí∞)</button>
      <button class="btn" id="saveBtn">Salvar</button>
      <button class="btn" id="exportBtn">Exportar</button>
      <input type="file" id="importFile" accept="application/json" style="display:none"/>
      <button class="btn" id="importBtn">Importar</button>
      <button class="btn danger" id="resetBtn">Recome√ßar</button>
    </div>
    <small class="link">Progresso salvo automaticamente (local). Nenhum servidor necess√°rio.</small>
  </section>
</aside>

<main>
  <div class="toolbar">
    <span>Ferramenta: </span>
    <button class="btn primary" data-tool="plant">üå± Plantar</button>
    <button class="btn" data-tool="harvest">üß∫ Colher</button>
    <button class="btn" data-tool="remove">ü™ì Remover</button>
    <span style="opacity:.7"> | Sementes selecionadas: <strong id="selectedSeed">‚Äî</strong></span>
  </div>
  <div class="field" id="field"></div>
</main>

<footer>
  <div>Feito com üíö para prototipar um jogo no estilo <em>fazendinha</em> (single-file).</div>
  <div class="link">Nome do jogo: <strong>Fazenda Feliz</strong></div>
</footer>

  </div><audio id="sfx-plant" preload="auto"><source src="data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBWFlaAAABAAAAAQAAAG1hZGUtd2l0aC1sb3Zlüí§" type="audio/wav"></audio> <audio id="sfx-harvest" preload="auto"><source src="data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBWFlaAAABAAAAAQAAAG1hZGUtd2l0aC1sb3Zlüí§" type="audio/wav"></audio> <audio id="sfx-buy" preload="auto"><source src="data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBWFlaAAABAAAAAQAAAG1hZGUtd2l0aC1sb3Zlüí§" type="audio/wav"></audio>

  <script>
    // ======= N√∫cleo do jogo (sem depend√™ncias) =======
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const CROPS = {
      cenoura: { name:"Cenoura", emoji:"ü•ï", seedEmoji:"üü†", buy: 5, stages:["üå±","üåø","ü•ï"], time: 30, xp: 6, sell: 12, minLevel:1 },
      milho:   { name:"Milho",   emoji:"üåΩ", seedEmoji:"üü°", buy:12, stages:["üå±","üåø","üåΩ"], time: 60, xp:10, sell: 28, minLevel:2 },
      morango: { name:"Morango", emoji:"üçì", seedEmoji:"üî¥", buy:20, stages:["üå±","üåø","üçì"], time:120, xp:18, sell: 55, minLevel:3 },
      girassol:{ name:"Girassol",emoji:"üåª", seedEmoji:"üü°", buy:30, stages:["üå±","üåø","üåª"], time:180, xp:25, sell: 90, minLevel:4 }
    };

    const SIZE = 6*6; // 36 canteiros

    const state = {
      coins: 50,
      energy: 100,
      energyMax: 100,
      xp: 0,
      level: 1,
      inventory: { cenoura: 3, milho: 0, morango: 0, girassol: 0 },
      field: Array.from({length: SIZE}, () => ({ crop:null, plantedAt:0, stage:0, ready:false, locked:false })),
      tool: 'plant',
      selectedSeed: null,
      lastTick: Date.now(),
    };

    const XP_LEVELS = [0,50,120,220,360,520,720,980,1300,1700];

    function levelForXP(xp){
      let lvl = 1; for(let i=1;i<XP_LEVELS.length;i++){ if(xp>=XP_LEVELS[i]) lvl=i+1; }
      return lvl;
    }

    function xpProgress(){
      const lvl = state.level;
      const curBase = XP_LEVELS[lvl-1] || 0;
      const nextBase = XP_LEVELS[lvl] || (curBase+200);
      const pct = Math.min(100, Math.floor(((state.xp - curBase) / (nextBase - curBase))*100));
      $('#xpbar').style.width = pct + '%';
      $('#xptext').textContent = `${Math.max(0,state.xp-curBase)}/${nextBase-curBase}`;
      $('#level').textContent = state.level;
    }

    function save(){ localStorage.setItem('fazenda_feliz_save', JSON.stringify(state)); }
    function load(){ const raw = localStorage.getItem('fazenda_feliz_save'); if(!raw) return; try{ const s = JSON.parse(raw); Object.assign(state, s); }catch(e){ console.warn('save corrompido'); } }

    function fmtTime(sec){ sec = Math.max(0,sec|0); const m=(sec/60)|0, s=(sec%60)|0; return `${m}:${s.toString().padStart(2,'0')}` }

    function canUseEnergy(cost=1){ return state.energy >= cost; }
    function useEnergy(cost=1){ state.energy = Math.max(0, state.energy - cost); updateHeader(); }

    function regenEnergy(){ // +1 a cada 10s
      const now = Date.now();
      const elapsed = now - (state._energyTick || now);
      const every = 10000;
      if(elapsed>=every){
        const inc = Math.floor(elapsed/every);
        state._energyTick = now - (elapsed % every);
        state.energy = Math.min(state.energyMax, state.energy + inc);
      }
    }

    function play(id){ const el = document.getElementById(id); if(!el) return; if(app.muted) return; try{ el.currentTime=0; el.play(); }catch(_){} }

    function updateHeader(){
      $('#coins').textContent = state.coins;
      $('#energy').textContent = state.energy;
      xpProgress();
    }

    function renderShop(){
      const wrap = $('#shop'); wrap.innerHTML='';
      Object.entries(CROPS).forEach(([key,c])=>{
        const allowed = state.level >= c.minLevel;
        const div = document.createElement('div');
        div.className='shop-item';
        div.innerHTML=`<div class="meta"><span class="emoji">${c.emoji}</span><div>${c.name}<br><small>‚è±Ô∏è ${c.time}s ‚Ä¢ +${c.xp} XP ‚Ä¢ Venda ${c.sell}ü™ô</small></div></div>
        <div><span style="margin-right:8px">ü™ô ${c.buy}</span><button ${!allowed?'disabled':''} data-buy="${key}">Comprar</button></div>`;
        wrap.appendChild(div);
      });
      wrap.addEventListener('click', e=>{
        const k = e.target.getAttribute?.('data-buy');
        if(!k) return;
        const item = CROPS[k];
        if(state.coins < item.buy) return alert('Moedas insuficientes.');
        state.coins -= item.buy; state.inventory[k] = (state.inventory[k]||0)+1; updateHeader(); renderInventory(); play('sfx-buy'); save();
      });
    }

    function renderInventory(){
      const wrap = $('#inventory'); wrap.innerHTML='';
      Object.entries(CROPS).forEach(([key,c])=>{
        const qty = state.inventory[key]||0;
        const div = document.createElement('div'); div.className='inv';
        div.innerHTML = `<span class="emoji">${c.emoji}</span>${c.name}<br><small>Qtd: ${qty}</small>`;
        div.style.outline = state.selectedSeed===key ? '2px solid var(--accent)' : 'none';
        div.style.cursor='pointer';
        div.addEventListener('click',()=>{ state.selectedSeed = key; $('#selectedSeed').textContent = `${c.emoji} ${c.name}`; renderInventory(); });
        wrap.appendChild(div);
      })
    }

    function buildField(){
      const field = $('#field'); field.innerHTML='';
      state.field.forEach((plot, i)=>{
        const el = document.createElement('div'); el.className='plot empty'; el.dataset.idx=i;
        el.innerHTML = `<div class="cell">üü´</div><div class="timer"></div><div class="stage"></div>`;
        field.appendChild(el);
      });
      field.addEventListener('click', onFieldClick);
      renderField();
    }

    function renderField(){
      state.field.forEach((p,i)=>{
        const el = $(`.plot[data-idx="${i}"]`);
        if(!el) return;
        const cell = el.querySelector('.cell'); const timer = el.querySelector('.timer'); const stage = el.querySelector('.stage');
        if(p.locked){ el.classList.add('locked'); }
        if(!p.crop){ el.classList.add('empty'); cell.textContent=''; cell.innerHTML='üü´'; timer.textContent=''; stage.textContent=''; return; }
        const crop = CROPS[p.crop];
        const elapsed = ((Date.now() - p.plantedAt)/1000)|0;
        const total = crop.time;
        const seg = Math.min(crop.stages.length-1, Math.floor(elapsed/(total/(crop.stages.length-1))));
        p.stage = seg;
        const done = elapsed >= total; p.ready = done;
        cell.textContent = crop.stages[seg];
        timer.textContent = done ? 'Pronto!' : `Falta ${fmtTime(total - elapsed)}`;
        stage.textContent = `${seg+1}/${crop.stages.length}`;
        el.classList.remove('empty');
      });
    }

    function onFieldClick(e){
      const el = e.target.closest('.plot'); if(!el) return;
      const idx = +el.dataset.idx; const p = state.field[idx];
      const tool = state.tool;
      if(p.locked) return;

      if(tool==='plant'){
        if(p.crop) return; // j√° ocupado
        if(!state.selectedSeed){ return alert('Selecione uma semente no invent√°rio.'); }
        if(!(state.inventory[state.selectedSeed] > 0)) return alert('Voc√™ n√£o tem essa semente.');
        if(!canUseEnergy()) return alert('Sem energia! Aguarde regenerar.');
        p.crop = state.selectedSeed; p.plantedAt = Date.now(); p.stage=0; p.ready=false; state.inventory[state.selectedSeed]--; useEnergy(1); play('sfx-plant');
        renderInventory(); renderField(); save();
      }
      else if(tool==='harvest'){
        if(!p.crop) return;
        const crop = CROPS[p.crop];
        const done = (Date.now()-p.plantedAt)/1000 >= crop.time;
        if(!done) return alert('Ainda n√£o est√° pronto.');
        if(!canUseEnergy()) return alert('Sem energia!');
        // recompensa
        state.coins += crop.sell; state.xp += crop.xp; useEnergy(1); play('sfx-harvest');
        // level up
        const newLvl = levelForXP(state.xp); if(newLvl!==state.level){ state.level=newLvl; renderShop(); toast(`Parab√©ns! N√≠vel ${state.level} desbloqueado üéâ`); }
        // limpa canteiro
        state.field[idx] = { crop:null, plantedAt:0, stage:0, ready:false, locked:false };
        updateHeader(); renderField(); save();
      }
      else if(tool==='remove'){
        if(!p.crop) return; state.field[idx] = { crop:null, plantedAt:0, stage:0, ready:false, locked:false }; renderField(); save();
      }
    }

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg; t.style.position='fixed'; t.style.bottom='20px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='rgba(0,0,0,.75)'; t.style.color='white'; t.style.padding='10px 14px'; t.style.borderRadius='999px'; t.style.fontWeight='800'; t.style.boxShadow='var(--shadow)';
      document.body.appendChild(t); setTimeout(()=>t.remove(), 2200);
    }

    function gameTick(){
      regenEnergy();
      renderField();
      updateHeader();
      save();
    }

    function setTool(tool){ state.tool=tool; $$('.toolbar [data-tool]').forEach(b=>{ b.classList.toggle('primary', b.dataset.tool===tool); }); }

    const app = { muted:false };
    function setupUI(){
      // ferramentas
      $$('.toolbar [data-tool]').forEach(b=> b.addEventListener('click',()=> setTool(b.dataset.tool)));
      setTool('plant');
      // bot√µes
      $('#sellAll').addEventListener('click',()=>{
        let total=0, xp=0, count=0;
        state.field.forEach((p,i)=>{ if(!p.crop) return; const c = CROPS[p.crop]; const done = (Date.now()-p.plantedAt)/1000 >= c.time; if(done){ total+=c.sell; xp+=c.xp; state.field[i] = { crop:null, plantedAt:0, stage:0, ready:false, locked:false }; count++; }});
        if(!count) return alert('Nada pronto para vender.');
        state.coins += total; state.xp += xp; const newLvl = levelForXP(state.xp); if(newLvl!==state.level){ state.level=newLvl; renderShop(); toast(`N√≠vel ${state.level} üéâ`);} updateHeader(); renderField(); save(); toast(`Vendeu ${count} colheitas por ${total}ü™ô (+${xp} XP)`);
      });
      $('#saveBtn').addEventListener('click',()=>{ save(); toast('Jogo salvo! üíæ'); });
      $('#exportBtn').addEventListener('click',()=>{
        const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='fazenda_feliz_save.json'; a.click(); URL.revokeObjectURL(a.href);
      });
      $('#importBtn').addEventListener('click',()=> $('#importFile').click());
      $('#importFile').addEventListener('change', async (ev)=>{
        const file = ev.target.files[0]; if(!file) return; const text = await file.text(); try{ const s = JSON.parse(text); Object.assign(state,s); buildField(); updateHeader(); renderShop(); renderInventory(); save(); toast('Save importado!'); }catch{ alert('Arquivo inv√°lido.'); }
      });
      $('#resetBtn').addEventListener('click',()=>{ if(confirm('Tem certeza que deseja recome√ßar?')){ localStorage.removeItem('fazenda_feliz_save'); location.reload(); }});
      $('#muteBtn').addEventListener('click',()=>{ app.muted=!app.muted; $('#muteBtn').textContent = app.muted ? 'üîá Silenciado' : 'üîä Som'; });
    }

    // ======= Inicializa√ß√£o =======
    load();
    buildField();
    renderShop();
    renderInventory();
    updateHeader();
    setupUI();
    setInterval(gameTick, 1000);
  </script></body>
</html>
